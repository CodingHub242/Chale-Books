<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Invoice Preview</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="invoice" class="preview-container">
    <div class="preview-grid">
      <!-- PDF Preview Section -->
      <div class="pdf-section">
        <div class="pdf-header">
          <div class="pdf-icon">
            <ion-icon name="document"></ion-icon>
          </div>
          <div class="pdf-info">
            <h3>Invoice Preview</h3>
            <p>Invoice #{{ invoice.invoice_number || invoice.id }}</p>
          </div>
        </div>
        <div class="pdf-content">
          <div *ngIf="pdfUrl" class="pdf-iframe-container">
            <iframe [src]="pdfUrl" class="pdf-iframe"></iframe>
          </div>
          <div *ngIf="!pdfUrl" class="pdf-loading">
            <div class="loading-content">
              <ion-icon name="document-outline"></ion-icon>
              <p>Loading PDF...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Email Composition Section -->
      <div class="email-section">
        <div class="email-header">
          <div class="email-icon">
            <ion-icon name="mail"></ion-icon>
          </div>
          <div class="email-info">
            <h3>Send Invoice</h3>
            <p>Compose and send your invoice</p>
          </div>
        </div>

        <div class="email-content">
          <form [formGroup]="emailForm" (ngSubmit)="sendInvoice()" class="email-form">
            <!-- Email Subject -->
            <div class="form-group">
              <ion-item class="form-item">
                <ion-label position="floating">Subject *</ion-label>
                <ion-input formControlName="subject" type="text" class="form-input"></ion-input>
              </ion-item>
            </div>

            <!-- Email Message -->
            <div class="form-group">
              <ion-item class="form-item">
                <ion-label position="floating">Message *</ion-label>
                <ion-textarea
                  formControlName="message"
                  rows="8"
                  placeholder="Enter your message here..."
                  class="form-textarea">
                </ion-textarea>
              </ion-item>
            </div>

            <!-- Invoice Details Summary -->
            <div class="invoice-summary" *ngIf="invoice">
              <div class="summary-header">
                <ion-icon name="information-circle"></ion-icon>
                <h4>Invoice Details</h4>
              </div>
              <div class="summary-content">
                <div class="summary-item">
                  <span class="label">Invoice #:</span>
                  <span class="value">{{ invoice.invoice_number || invoice.id }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Client:</span>
                  <span class="value">{{ invoice.client?.name }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Amount:</span>
                  <span class="value amount">{{ invoice.total || invoice.amount | number:'1.2-2' }} {{ invoice.currency?.code }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Due Date:</span>
                  <span class="value">{{ formatDueDate(invoice.due_date) }}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Status:</span>
                  <span class="value">
                    <ion-badge [color]="getStatusColor(invoice.status)">
                      {{ invoice.status | uppercase }}
                    </ion-badge>
                  </span>
                </div>
              </div>
            </div>

            <!-- Send Button -->
            <div class="form-actions">
              <ion-button
                expand="block"
                type="submit"
                [disabled]="!emailForm.valid"
                class="send-button">
                <ion-icon name="send" slot="start"></ion-icon>
                Send Invoice
              </ion-button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="!invoice" class="loading-state">
    <div class="loading-content">
      <ion-icon name="document-outline"></ion-icon>
      <p>Loading invoice...</p>
    </div>
  </div>
</ion-content>
