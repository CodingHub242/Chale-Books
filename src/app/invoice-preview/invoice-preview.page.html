<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Invoice Preview</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-grid *ngIf="invoice" style="height: 100%;">
    <ion-row style="height: 100%;">
      <!-- PDF Preview Section -->
      <ion-col size="12" size-lg="8" style="height: 100%;">
        <ion-card style="height: 100%; margin: 0;">
          <ion-card-content style="height: 100%; padding: 0;">
            <div *ngIf="pdfUrl" style="height: 100%; width: 100%;">
              <iframe [src]="pdfUrl" style="width: 100%; height: 100%; border: none;"></iframe>
            </div>
            <div *ngIf="!pdfUrl" style="display: flex; align-items: center; justify-content: center; height: 100%;">
              <ion-icon name="document-outline" size="large" color="medium"></ion-icon>
              <p style="margin-left: 10px;">Loading PDF...</p>
            </div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Email Composition Section -->
      <ion-col size="12" size-lg="4" style="height: 100%;">
        <ion-card style="height: 100%; margin: 0;">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="mail" slot="start"></ion-icon>
              Send Invoice
            </ion-card-title>
          </ion-card-header>
          <ion-card-content style="height: calc(100% - 60px); overflow-y: auto;">
            <form [formGroup]="emailForm" (ngSubmit)="sendInvoice()">
              <!-- Email Subject -->
              <ion-item>
                <ion-label position="floating">Subject *</ion-label>
                <ion-input formControlName="subject" type="text"></ion-input>
              </ion-item>

              <!-- Email Message -->
              <ion-item>
                <ion-label position="floating">Message *</ion-label>
                <ion-textarea
                  formControlName="message"
                  rows="8"
                  placeholder="Enter your message here...">
                </ion-textarea>
              </ion-item>

              <!-- Invoice Details Summary -->
              <ion-card *ngIf="invoice" style="margin: 16px 0;">
                <ion-card-header>
                  <ion-card-title style="font-size: 16px;">Invoice Details</ion-card-title>
                </ion-card-header>
                <ion-card-content>
                  <p><strong>Invoice #:</strong> {{ invoice.invoice_number || invoice.id }}</p>
                  <p><strong>Client:</strong> {{ invoice.client?.name }}</p>
                  <p><strong>Amount:</strong> {{ invoice.total || invoice.amount | number:'1.2-2' }} {{ invoice.currency?.code }}</p>
                  <p><strong>Due Date:</strong> {{ invoice.due_date }}</p>
                  <p><strong>Status:</strong> {{ invoice.status | uppercase }}</p>
                </ion-card-content>
              </ion-card>

              <!-- Send Button -->
              <ion-button
                expand="block"
                type="submit"
                [disabled]="!emailForm.valid"
                style="margin-top: 16px;">
                <ion-icon name="send" slot="start"></ion-icon>
                Send Invoice
              </ion-button>
            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Loading State -->
  <div *ngIf="!invoice" style="display: flex; align-items: center; justify-content: center; height: 100%;">
    <ion-icon name="document-outline" size="large" color="medium"></ion-icon>
    <p style="margin-left: 10px;">Loading invoice...</p>
  </div>
</ion-content>
